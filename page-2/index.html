<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Book Appointment - Medic Africa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css"
    integrity="sha512-5Hs3dF2AEPkpNAR7UiOHba+lRSJNeM2ECkwxUIxC1Q/FLycGTbNapWXB4tP889k5T5Ju8fs4b1P5z/iB4nMfSQ=="
    crossorigin="anonymous" referrerpolicy="no-referrer"/>
    <link rel="stylesheet" href="style.css">

    <!-- BACKUP: Inline CSS in case style.css doesn't load -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: sans-serif;
            user-select: none;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa, #c9dce8);
            min-height: 100vh;
            padding-top: 80px;
        }

        nav {
            background: #0077b6;
            padding: 15px 30px;
            display: flex;
            top: 0;
            justify-content: space-between;
            align-items: center;
            color: #fff;
            position: fixed;
            width: 100%;
            z-index: 1000;
        }

        nav a {
            color: #fff;
            text-decoration: none;
            margin-left: 25px;
            font-weight: bold;
        }

        nav a.active {
            border-bottom: 3px solid #fff;
            padding-bottom: 5px;
        }

        .logo {
            font-weight: bold;
            font-size: x-large;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-container {
            background: #fff;
            width: 90%;
            max-width: 500px;
            margin: 40px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
            color: #023e8a;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            font-weight: bold;
            display: block;
            color: #333;
            margin-bottom: 5px;
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #0077b6;
        }

        .btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            border: none;
            font-size: 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
        }

        .book-btn {
            background: #0096c7;
            color: #fff;
        }

        .book-btn:hover {
            background: #0077b6;
        }

        .book-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .print-btn {
            background: #48cae4;
            color: #023e8a;
        }

        .print-btn:hover {
            background: #00b4d8;
        }
    </style>
</head>
<body>
    <nav>
        <div class="logo">
            <i class="fa fa-medkit" aria-hidden="true"></i>
            Medic Africa
        </div>
        <div>
            <a id="homeLink" href="../index.html">Home</a>
            <a id="loginLink" href="../page 1/login.html">Login</a>
            <a id="bookLink" href="index.html">Book Appointment</a>
        </div>
    </nav>

    <div class="form-container">
        <h2>Book Appointment</h2>

        <!-- STEP 1: Add ID to form and IDs to all inputs so we can get their values -->
        <form id="appointmentForm">
            <div class="form-group">
                <label>First Name</label>
                <input type="text" id="firstName" required>
            </div>

            <div class="form-group">
                <label>Last Name</label>
                <input type="text" id="lastName" required>
            </div>

            <div class="form-group">
                <label>Phone Number</label>
                <input type="tel" id="phone" required>
            </div>

            <div class="form-group">
                <label>Email</label>
                <input type="email" id="email" required>
            </div>

            <div class="form-group">
                <label>Country</label>
                <input type="text" id="country" required>
            </div>

            <div class="form-group">
                <label>State</label>
                <input type="text" id="state" required>
            </div>

            <div class="form-group">
                <label>LGA</label>
                <input type="text" id="lga" required>
            </div>

            <!-- You might want to add these fields for a complete appointment -->
            <div class="form-group">
                <label>Preferred Date</label>
                <input type="date" id="appointmentDate" required>
            </div>

            <div class="form-group">
                <label>Preferred Time</label>
                <input type="time" id="appointmentTime" required>
            </div>

            <div class="form-group">
                <label>Reason for Visit</label>
                <textarea id="reason" rows="3"></textarea>
            </div>

            <button type="submit" class="btn book-btn">Book Appointment</button>
            <button type="button" class="btn print-btn" id="printBtn">Print</button>
        </form>
    </div>

    <!-- STEP 2: Load the navigation script -->
    <script src="script.js"></script>

    <!-- STEP 3: Add backend integration script -->
    <script>
        // =================================================================
        // BACKEND INTEGRATION - APPOINTMENT BOOKING
        // =================================================================

        // Your backend URL
        const API_BASE_URL = 'https://medic-africa-1.onrender.com';

        // Get the form element
        const appointmentForm = document.getElementById('appointmentForm');

        // Listen for form submission
        appointmentForm.addEventListener('submit', async function(e) {
            // IMPORTANT: Prevent default form submission (which would reload the page)
            e.preventDefault();

            // STEP 1: Get all the input values from the form
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                country: document.getElementById('country').value,
                state: document.getElementById('state').value,
                lga: document.getElementById('lga').value,
                appointmentDate: document.getElementById('appointmentDate').value,
                appointmentTime: document.getElementById('appointmentTime').value,
                reason: document.getElementById('reason').value
            };

            // STEP 2: Get the submit button so we can show loading state
            const submitBtn = e.target.querySelector('.book-btn');
            const originalBtnText = submitBtn.textContent;

            // Show loading state
            submitBtn.disabled = true;
            submitBtn.textContent = 'Booking...';
            submitBtn.style.opacity = '0.7';

            try {
                // STEP 3: Get the authentication token (if user is logged in)
                // This assumes user logged in earlier and token was saved
                const authToken = localStorage.getItem('authToken');

                // STEP 4: Prepare headers for the request
                const headers = {
                    'Content-Type': 'application/json'
                };

                // Add authorization header if user is logged in
                if (authToken) {
                    headers['Authorization'] = `Bearer ${authToken}`;
                }

                // STEP 5: Send POST request to backend
                const response = await fetch(`${API_BASE_URL}/api/appointments`, {
                    method: 'POST',
                    headers: headers,
                    body: JSON.stringify(formData) // Convert form data to JSON
                });

                // STEP 6: Parse the response from backend
                const data = await response.json();

                // STEP 7: Check if request was successful
                if (response.ok) {
                    // SUCCESS! Show success message
                    alert('✅ Appointment booked successfully!\n\n' +
                          'Appointment Details:\n' +
                          `Name: ${formData.firstName} ${formData.lastName}\n` +
                          `Date: ${formData.appointmentDate}\n` +
                          `Time: ${formData.appointmentTime}`);

                    // Optional: Save appointment ID for later use
                    if (data.appointmentId) {
                        localStorage.setItem('lastAppointmentId', data.appointmentId);
                    }

                    // Reset the form
                    appointmentForm.reset();

                    // Optional: Redirect to confirmation page or home
                    // setTimeout(() => {
                    //     window.location.href = '../index.html';
                    // }, 2000);

                } else {
                    // FAILED: Show error message from backend
                    alert('❌ Booking failed: ' + (data.message || 'Please try again'));
                }

            } catch (error) {
                // STEP 8: Handle network errors or other exceptions
                console.error('Error:', error);
                alert('❌ Connection error. Please check your internet and try again.');
            } finally {
                // STEP 9: Always restore button state (whether success or error)
                submitBtn.disabled = false;
                submitBtn.textContent = originalBtnText;
                submitBtn.style.opacity = '1';
            }
        });

        // =================================================================
        // PRINT FUNCTIONALITY
        // =================================================================

        document.getElementById('printBtn').addEventListener('click', function() {
            // Check if form is filled
            const firstName = document.getElementById('firstName').value;
            const lastName = document.getElementById('lastName').value;

            if (!firstName || !lastName) {
                alert('Please fill in the appointment details first!');
                return;
            }

            // Create a printable version
            window.print();
        });

        // =================================================================
        // OPTIONAL: Check if user is logged in on page load
        // =================================================================

        window.addEventListener('DOMContentLoaded', function() {
            const authToken = localStorage.getItem('authToken');
            const userData = localStorage.getItem('userData');

            // If user is logged in, pre-fill their information
            if (authToken && userData) {
                try {
                    const user = JSON.parse(userData);

                    // Pre-fill email if available
                    if (user.email) {
                        document.getElementById('email').value = user.email;
                    }

                    // Pre-fill phone if available
                    if (user.phone) {
                        document.getElementById('phone').value = user.phone;
                    }

                    // Pre-fill name if available
                    if (user.firstName) {
                        document.getElementById('firstName').value = user.firstName;
                    }
                    if (user.lastName) {
                        document.getElementById('lastName').value = user.lastName;
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                }
            }
        });
    </script>
</body>
</html>